# cs2kz-web-lrweb

## Описание

Модуль KZ Records предназначен для отображения статистики рекордов режима KZ. Модуль работает исключительно с KZ картами (начинающимися с kz_) и показывает только рекорды со стилем Normal.

## Основные возможности

- **Отображение рекордов KZ карт** - таблица лидеров по выбранной карте с сортировкой по времени прохождения
- **Статистика** - общее количество рекордов, игроков и карт
- **Поиск и фильтрация** - быстрый поиск KZ карт по названию
- **API интерфейс** - REST API для получения данных с кешированием
- **Адаптивный дизайн** - корректная работа на всех устройствах
- **Система безопасности** - защита от SQL-инъекций и ограничение скорости запросов
- **Многоязычность** - поддержка русского, английского и украинского языков

## Требования

- **PHP 7.4+**
- **MySQL 5.7+**
- [NEO 3.5](https://stellarteam.store/resource/template-neo-v3)

## Установка

1. **Скопируйте модуль** в `/app/modules/`
2. **Настройте базу данных в админ панели** - `kz`
3. **Очистите кеш переводов** в админ панели

## Конфигурация

### Настройки модуля (settings.php)

```php
return [
    'display' => [
        'default_map' => 'kz_grotto',        // Карта по умолчанию
        'records_per_page' => 50,            // Рекордов на странице
        'map_division' => false,             // Разделение карт
        'default_tab' => 'kz'                // Активная вкладка
    ],
    'cache' => [
        'enabled' => true,                   // Включить кеширование
        'time' => 1800,                     // Время кеша (сек)
        'maps_cache_time' => 3600,          // Кеш карт (сек)
        'stats_cache_time' => 900,          // Кеш статистики (сек)
        'records_cache_time' => 600         // Кеш рекордов (сек)
    ]
];
```

## Система безопасности

### Защита от SQL-инъекций

1. **Валидация входных данных** - проверка формата имени карты, фильтрация опасных символов
2. **Подготовленные запросы** - использование mysqli prepared statements
3. **Мониторинг безопасности** - логирование попыток инъекций

### Ограничение скорости запросов

- **API:** 100 запросов в минуту
- **Интерфейс:** 30 запросов в минуту
- **Автоматическая блокировка** при превышении лимитов

## База данных

### Структура таблиц

Модуль работает со следующими таблицами:
- **Maps** - информация о картах
- **MapCourses** - курсы карт
- **Times** - времена прохождения
- **Players** - данные игроков

## Кеширование

### Типы кеша

1. **Карты** - 1 час
2. **Статистика** - 15 минут  
3. **Рекорды** - 10 минут
4. **Общий кеш** - 30 минут

## Переводы

### Поддерживаемые языки

- **RU** - Русский
- **EN** - Английский
- **UA** - Украинский

## Устранение неполадок

### Частые проблемы

1. **Ошибка подключения к БД**
   - Проверьте настройки в `db.php`
   - Убедитесь в доступности сервера БД

2. **Пустые рекорды**
   - Проверьте наличие данных в таблицах
   - Убедитесь в правильности фильтров

3. **Ошибки кеширования**
   - Проверьте права на запись в `storage/modules_cache/`
   - Очистите кеш модуля
